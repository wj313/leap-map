<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script src="https://js.leapmotion.com/leap-0.6.0.min.js"></script>
    <script src="https://js.leapmotion.com/leap-plugins-0.1.6.js"></script>
    <script src="https://js.leapmotion.com/leap.rigged-hand-0.1.4.min.js"></script>

    <script>

var map;
var panorama = null;
var currentLatLng = null;
var proceed = true;
var controller = null;

function difference(a, b) {
    var d = Math.abs(a - b);
    return d > 180 ? 360 - d : d;
};

function closest(a, bs) {
    var ds = bs.map(function (b) { return difference(a, b); });
    return bs[ds.indexOf(Math.min.apply(null, ds))];
};

function initialize() {
  var mapOptions = {
    zoom: 15,
    center: new google.maps.LatLng(41.705455, -86.235350),
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    mapTypeControlOptions: {
        position: google.maps.ControlPosition.TOP_LEFT
    }
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  var thePanorama = map.getStreetView();

  google.maps.event.addListener(thePanorama, 'visible_changed', function () {

      if (thePanorama.getVisible()) {
          panorama = thePanorama;
      } else {
      }

  });

  controller = new Leap.Controller({ enableGestures: true });
  controller.connect();

  listenToLeap();
}

function listenToLeap() {
    window.setInterval(function () {

        if (proceed == true) {
            proceed = false;
            var frame = controller.frame();
            if (frame.hands.length > 0) {
                var hand = frame.hands[0];
                var pitch = hand.pitch();
                var yaw = hand.yaw();
                var roll = hand.roll();

                //Convert to degrees
                pitch = pitch * 180 / Math.PI; 
                yaw = yaw * 180 / Math.PI; 
                roll = roll * 180 / Math.PI;

                if (pitch <= -2 && roll < 15 && roll > -15) {
                    findNextPanorama();
                }
                else {
                    if (roll >= 15) {
                        changePov("left");
                    }
                    else if (roll <= -15) {
                        changePov("right");
                    }
                }

            }
            proceed = true;
        }
    }, 100);
}

function changePov(direction) {
    if (panorama != null)
    {
        var myPov = panorama.getPov();
        switch (direction) {
            case "left":
                panorama.setPov({ heading: myPov.heading - 3, pitch: myPov.pitch });
                break;
            case "right":
                panorama.setPov({ heading: myPov.heading + 3, pitch: myPov.pitch });
                break;
        }
    }
}

function findNextPanorama() {

    if (panorama != null) {
        currentLatLng = panorama.getPosition();
        var myPano = panorama.getPov().heading;
        var myPanoVal = panorama.getPov();
        if (myPano < 0) {
            myPano = myPano + 360;
        }
        var links = panorama.getLinks();
        var i = 0;
        var headingArrays = [];
        for (i = 0; i < links.length; i++) {
            headingArrays.push(links[i].heading);
        }

        var closestHeading = closest(myPano, headingArrays);

        //Set pano to the next closest pano
        for (i = 0; i < links.length; i++) {
            if (links[i].heading == closestHeading) {
                panorama.setPano(links[i].pano);
                panorama.setPov(myPanoVal);
                i = links.length;
            }
        }

    }
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>